USE BD_SUPERMERCADO_FUNCIONARIO_PRODUTO_CONSUMIDOR;
INSERT INTO SUPERMERCADO (
	SUP_CNPJ,
    SUR_RAZAO_SOCIAL,
    SUP_TELEFONE,
    SUP_EMAIL,
    SUP_ENDERECO_LOGRADOURO,
    SUP_ENDERECO_NUMERO,
    SUP_ENDERECO_CIDADE,
    SUP_EDERECO_ESTADO)
VALUES (
	"12345678000101",
    "Supermercado Grick",
    "12333412",
    "grick_tambau@email.com",
    "Grick Street",
    "10000",
    "Tambacity",
    "SP"
);

INSERT INTO SUPERMERCADO (
	SUP_CNPJ,
    SUR_RAZAO_SOCIAL,
    SUP_TELEFONE,
    SUP_EMAIL,
    SUP_ENDERECO_LOGRADOURO,
    SUP_ENDERECO_NUMERO,
    SUP_ENDERECO_CIDADE,
    SUP_EDERECO_ESTADO)
VALUES (
	"12345678919101",
    "Pontes",
    "1232412",
    "Pontes Lanches",
    "Pontes Brigde",
    "13121",
    "Tambacity",
    "SP"
);

INSERT INTO SUPERMERCADO (
	SUP_CNPJ,
    SUR_RAZAO_SOCIAL,
    SUP_TELEFONE,
    SUP_EMAIL,
    SUP_ENDERECO_LOGRADOURO,
    SUP_ENDERECO_NUMERO,
    SUP_ENDERECO_CIDADE,
    SUP_EDERECO_ESTADO)
VALUES (
	"1234567045101",
    "Jall",
    "1233912",
    "Jall_compra_nois@gmail.com",
    "Rua do Brasa Brothers",
    "1312355",
    "Tambacity",
    "SP"
);

INSERT INTO SUPERMERCADO (
	SUP_CNPJ,
    SUR_RAZAO_SOCIAL,
    SUP_TELEFONE,
    SUP_EMAIL,
    SUP_ENDERECO_LOGRADOURO,
    SUP_ENDERECO_NUMERO,
    SUP_ENDERECO_CIDADE,
    SUP_EDERECO_ESTADO)
VALUES (
	"3234567848123",
    "Mercado do Cidin",
    "12312412",
    "cidin_venda@email.com",
    "Érico primo Uiana fé",
    "183",
    "Tambacity",
    "SP"
);

INSERT INTO SUPERMERCADO (
SUP_CNPJ,
    SUR_RAZAO_SOCIAL,
    SUP_TELEFONE,
    SUP_EMAIL,
    SUP_ENDERECO_LOGRADOURO,
    SUP_ENDERECO_NUMERO,
    SUP_ENDERECO_CIDADE,
    SUP_EDERECO_ESTADO)
VALUES (
	"12345678220101",
    "São Francisco stores",
    "12377412",
    "San francisco pai@email.com",
    "Aquele lugar lá, perto do coiso",
    "1030",
    "Tambacity",
    "SP"
);
SELECT * FROM SUPERMERCADO;

DELETE FROM SUPERMERCADO
WHERE SUP_CNPJ = "";


INSERT INTO PRODUTO(
	PRO_CODIGO_BARRAS,
    PRO_NOME,
    PRO_PESO,
    PRO_QUANTIDADE,
    PRO_PRECO,
    PRO_DATA_VALIDADE
)
VALUES (
	"30910239109319832",
    "ARROZ 5KG",
     5.0,
    "500",
    26.90,
    '2025-12-25'
);

INSERT INTO PRODUTO(
	PRO_CODIGO_BARRAS,
    PRO_NOME,
    PRO_PESO,
    PRO_QUANTIDADE,
    PRO_PRECO,
    PRO_DATA_VALIDADE
)
VALUES (
	"7891234567890",
    "FEIJAO CARIOCA 1KG",
     1.0,
    "300",
    8.50,
    '2026-01-15'
);

INSERT INTO PRODUTO(
	PRO_CODIGO_BARRAS,
    PRO_NOME,
    PRO_PESO,
    PRO_QUANTIDADE,
    PRO_PRECO,
    PRO_DATA_VALIDADE
)
VALUES (
	"7896543219876",
    "OLEO DE SOJA 900ML",
     0.9,
    "200",
    7.20,
    '2025-11-10'
);

INSERT INTO PRODUTO(
	PRO_CODIGO_BARRAS,
    PRO_NOME,
    PRO_PESO,
    PRO_QUANTIDADE,
    PRO_PRECO,
    PRO_DATA_VALIDADE
)
VALUES (
	"7893332221110",
    "AÇUCAR REFINADO 1KG",
     1.0,
    "400",
    4.80,
    '2026-03-01'
);

INSERT INTO PRODUTO(
	PRO_CODIGO_BARRAS,
    PRO_NOME,
    PRO_PESO,
    PRO_QUANTIDADE,
    PRO_PRECO,
    PRO_DATA_VALIDADE
)
VALUES (
	"7890001112223",
    "CAFÉ TRADICIONAL 500G",
     0.5,
    "250",
    12.75,
    '2025-09-30'
);
SELECT * FROM PRODUTO;

INSERT INTO CONSUMIDOR (
	CON_CPF,
    CON_NOME,
    CON_TELEFONE,
    CON_EMAIL
)
VALUES (
	"44636134850",
    "Felipe Donizetti Ribeiro",
    "19 99437-0065",
    "LipeRibeiro0509@gmail.com"
);

INSERT INTO CONSUMIDOR (
	CON_CPF,
    CON_NOME,
    CON_TELEFONE,
    CON_EMAIL
)
VALUES (
	"32165498700",
    "Mariana Alves Costa",
    "11 98765-4321",
    "mariana.costa@gmail.com"
);

INSERT INTO CONSUMIDOR (
	CON_CPF,
    CON_NOME,
    CON_TELEFONE,
    CON_EMAIL
)
VALUES (
	"45896312789",
    "Rafael Souza Lima",
    "21 99654-2233",
    "rafael.lima@hotmail.com"
);

INSERT INTO CONSUMIDOR (
	CON_CPF,
    CON_NOME,
    CON_TELEFONE,
    CON_EMAIL
)
VALUES (
	"70213456890",
    "Camila Torres Mendes",
    "31 98234-5566",
    "camila.mendes@yahoo.com"
);

INSERT INTO CONSUMIDOR (
	CON_CPF,
    CON_NOME,
    CON_TELEFONE,
    CON_EMAIL
)
VALUES (
	"91564327810",
    "Lucas Fernandes Oliveira",
    "41 99788-1144",
    "lucas.oliveira@outlook.com"
);
SELECT * FROM CONSUMIDOR;

INSERT INTO FUNCIONARIO (
	FUN_CPF,
    FUN_NOME,
    FUN_DATA_NASCIMENTO,
    FUN_TELEFONE,
    FUN_EMAIL,
    FUN_CARTEIRA_TRABALHO,
    FUN_BANCO_AGENCIA,
    FUN_BANCO_CONTA,
    FUN_DATA_ADMISSAO,
    FUN_JORNADA_TRABALHO,
    FK_SUP_CNPJ
)
VALUES (
	"12345678910",
    "ZÉZINHO",
    "1985-03-12",
    "11987654321",
    "zezin_ranca_diu@gmail.com",
    "cart_zezin.pdf",
    "1234",
    "56789",
    "2020-01-15",
    44,
    "12345678000101"
);

INSERT INTO FUNCIONARIO (
	FUN_CPF,
    FUN_NOME,
    FUN_DATA_NASCIMENTO,
    FUN_TELEFONE,
    FUN_EMAIL,
    FUN_CARTEIRA_TRABALHO,
    FUN_BANCO_AGENCIA,
    FUN_BANCO_CONTA,
    FUN_DATA_ADMISSAO,
    FUN_JORNADA_TRABALHO,
    FK_SUP_CNPJ
)
VALUES (
	"98765432100",
    "Maria Clara Santos",
    "1990-07-21",
    "11995544332",
    "maria.clara@gmail.com",
    "ct_maria.pdf",
    "4321",
    "99887",
    "2019-08-10",
    40,
    "12345678919101"
);

INSERT INTO FUNCIONARIO (
	FUN_CPF,
    FUN_NOME,
    FUN_DATA_NASCIMENTO,
    FUN_TELEFONE,
    FUN_EMAIL,
    FUN_CARTEIRA_TRABALHO,
    FUN_BANCO_AGENCIA,
    FUN_BANCO_CONTA,
    FUN_DATA_ADMISSAO,
    FUN_JORNADA_TRABALHO,
    FK_SUP_CNPJ
)
VALUES (
	"65498732111",
    "Carlos Henrique Souza",
    "1988-02-05",
    "21987654321",
    "carlos.henrique@hotmail.com",
    "ct_carlos.pdf",
    "5678",
    "33445",
    "2021-04-22",
    44,
    "1234567045101"
);

INSERT INTO FUNCIONARIO (
	FUN_CPF,
    FUN_NOME,
    FUN_DATA_NASCIMENTO,
    FUN_TELEFONE,
    FUN_EMAIL,
    FUN_CARTEIRA_TRABALHO,
    FUN_BANCO_AGENCIA,
    FUN_BANCO_CONTA,
    FUN_DATA_ADMISSAO,
    FUN_JORNADA_TRABALHO,
    FK_SUP_CNPJ
)
VALUES (
	"32178965422",
    "Ana Beatriz Lima",
    "1995-10-30",
    "31991223344",
    "ana.beatriz@yahoo.com",
    "ct_ana.pdf",
    "7890",
    "55667",
    "2022-06-13",
    36,
    "3234567848123"
);

INSERT INTO FUNCIONARIO (
	FUN_CPF,
    FUN_NOME,
    FUN_DATA_NASCIMENTO,
    FUN_TELEFONE,
    FUN_EMAIL,
    FUN_CARTEIRA_TRABALHO,
    FUN_BANCO_AGENCIA,
    FUN_BANCO_CONTA,
    FUN_DATA_ADMISSAO,
    FUN_JORNADA_TRABALHO,
    FK_SUP_CNPJ
)
VALUES (
	"85296374100",
    "João Pedro Martins",
    "1992-12-08",
    "41997885566",
    "joao.martins@outlook.com",
    "ct_joao.pdf",
    "3456",
    "77889",
    "2018-11-01",
    44,
    "12345678220101"
);
SELECT * FROM SUPERMERCADO;
INSERT INTO SUPERMERCADO_PRODUTO (FK_SUP_CNPJ, FK_PRO_ID)
VALUES
("1234567045101", 1),
("12345678000101", 2),
("12345678220101", 3),
("12345678919101", 4),
("3234567848123", 5);

INSERT INTO PRODUTO_CONSUMIDOR (FK_CON_CPF, FK_PRO_ID)
VALUES
("44636134850", 1),
("32165498700", 2),
("45896312789", 3),
("70213456890", 4),
("91564327810", 5);

SELECT * FROM SUPERMERCADO;

/* 
CONSULTAR O AUMENTO DE R$ 2,00 NO PREÇO DOS PRODUTOS COM PREÇO ATUAL >= R$ 5,00
*/

SELECT PRO_NOME AS "NOME",
		PRO_CODIGO_BARRAS AS "CÓDIGO DE BARRAS",
		PRO_PRECO AS "PREÇO ATUAL",
        TRUNCATE((PRO_PRECO + 2),2) AS "PREÇO COM AJUSTDE DE R$ 2,00"
FROM 	PRODUTO
WHERE 	PRO_PRECO >= 5;

/*
CONSULTAR A REDUÇÃO DE R$ 1,00 NO PREÇO DOS PRODUTOS COM PREÇO ATUAL
ABAIXO DE R$ 5,00 OU R$ 10,00
*/

SELECT PRO_NOME AS "NOME",
		PRO_CODIGO_BARRAS AS "CÓDIGO DE BARRAS",
		PRO_PRECO AS "PREÇO ATUAL",
        TRUNCATE((PRO_PRECO -1),2) AS "PREÇO COM REDUÇÃO DE R$ 1,00"
FROM 	PRODUTO
WHERE 	PRO_PRECO < 10;

/* 
	CONSULTAR COMO SERIA APLICAR UM DESCONTO DE 10% EM TODOS OS PRODUTOS
*/

SELECT PRO_NOME AS "NOME",
		PRO_CODIGO_BARRAS AS "CÓDIGO DE BARRAS",
		PRO_PRECO AS "PREÇO ATUAL",
        TRUNCATE((PRO_PRECO -  (PRO_PRECO * 0.1)),2) AS "PREÇO COM DESCONTO DE 10%"
FROM 	PRODUTO;

/* 
	AJUSTAR O ESTOQUE DO PRIMEIRO PRODUTO, DIVIDINDO PELA METADE 
*/ 

SELECT 	PRO_ID,
		PRO_NOME,
        PRO_CODIGO_BARRAS,
        PRO_QUANTIDADE
FROM PRODUTO;

UPDATE PRODUTO
SET PRO_QUANTIDADE = PRO_QUANTIDADE / 2
WHERE PRO_ID = 1;

/* CONSULTAR TODOS OS PRODUTOS QUE TENHAM DATA DE VALIDADE ENTRE SETEMBRO DE 2025 E DEZEMBRO DE 2025
OPERADOR LÓGICO BETWEEN -> ENTRE
*/

SELECT PRO_NOME AS "NOME",
		PRO_CODIGO_BARRAS AS "CÓDIGO DE BARRAS",
        PRO_DATA_VALIDADE AS "DATA DE VALIDADE"
FROM PRODUTO
WHERE PRO_DATA_VALIDADE BETWEEN '2025-09-01' AND '2025-12-31';


/* CONSULTAR TODOS OS PRODUTOS QUE TENHAM PREÇO MAIOR QUE R$ 10,00 OU MENOR QUE R$ 4,00 
PRECO > 10 && PRECO < 4
*/

SELECT PRO_NOME AS 'NOME',
		PRO_CODIGO_BARRAS AS 'CÓDIGO DE BARRAS',
        PRO_PRECO AS "PREÇO"
FROM PRODUTO
WHERE PRO_PRECO >= 10 OR PRO_PRECO <= 4;

/* CONSULTAR OS DDS E TELEFONE DOS CONSUMIDORES SEPARADAMENTE */ 

SELECT 	CON_NOME						AS 	'NOME DO CONSUMIDOR',
		CON_CPF 						AS 	'CPF DO CONSUMIDOR',
        SUBSTRING(CON_TELEFONE,1,2) 	AS 'DDD DO TELEFONE',
        SUBSTRING(CON_TELEFONE,3,11)	AS 'NUMERO DO TELEFONE'
FROM 	CONSUMIDOR;

/* GERAR UMA FRASE CONTCATENANDO:
RAZÃO SOCIAL, CNPJ, TELEFONE E EMAIL 
CONCAT ('CPF','GABRIEL')
*/

SELECT 	CONCAT("RAZÃO SOCIAL: " , SUR_RAZAO_SOCIAL,
		CONCAT(' | CNPJ: ', SUP_CNPJ, 
        CONCAT(' | TELEFONE: ', SUP_TELEFONE, 
        CONCAT(' | EMAIL: ', SUP_EMAIL)))) 
        AS FRASE
FROM SUPERMERCADO;

/* GERAR UMA CONSULTA QUE VERIFICA O STATUS DO ESTOQUE DOS PRODUTOS.
REGRAS
1) QUANTIDADE <= 25: ESTOQUE BAIXO
2) QUANTIDADE > 25 E QUANTIDADE <=100: ESTOQUE MÉDIO
3) QUANTIDADE > 100: ESTOQUE ALTO
 */
 
 SELECT PRO_NOME 			AS "NOME DO PRODUTO",
		PRO_CODIGO_BARRAS 	AS "CÓDIGO DE BARRAS",
        PRO_QUANTIDADE 		AS "QUANTIDADE",
        CASE
			WHEN PRO_QUANTIDADE <=25 THEN "ESTOQUE BAIXO"
            WHEN PRO_QUANTIDADE > 25 AND PRO_QUANTIDADE < 100 THEN "ESTOQUE MÉDIO"
            WHEN PRO_QUANTIDADE >= 100 THEN "ESTOQUE ALTO"
		END AS "NÍVEL DE ESTOQUE"
FROM 	PRODUTO;

/* GERAR UMA CONSULTA QUE VERIFICA O PESO DOS PRODUTOS 
VALORES QUE VÃO SER RETORNADOS: NOME, CODIGO DE BARRAS, QUANTIDADE, DATA DE VALIDADE, PESO E CLASSIFICAÇÃO DE PESO.
REGRAS:
1) PESO <=5: PESO BAIXO
2) PESO > 5 E PESO <=50 : PESO MÉDIO
3) PESO >= 50: PESO ALTO
*/

SELECT 	PRO_NOME 			AS "NOME DO PRODUTO",
		PRO_CODIGO_BARRAS	AS "CÓDIGO DE BARRAS",
        PRO_QUANTIDADE 		AS "QUANTIDADE PRODUTO",
        PRO_DATA_VALIDADE	AS "DATA DE VALIDADE",
        PRO_PESO 			AS "PESO DO PRODUTO",
        CASE
			WHEN PRO_PESO <= 5 THEN "PESO BAIXO"
            WHEN PRO_PESO >5 AND PRO_PESO <= 50 THEN "PESO MEDIO"
            WHEN PRO_PESO > 50 THEN "PESO ALTO"
		END AS "CLASSIFICAÇÃO DE PESO"
FROM PRODUTO;

/* CONTAR QUANTOS CONSUMIDORES TEMOS CADASTROS*/
 
 SELECT COUNT(*) AS "NUMERO DE CONSUMIDORES"
 FROM CONSUMIDOR;
 
 /* CONTAR QUANTOS FUNCIONÁRIOS TEMOS CADASTROS*/
 
 SELECT COUNT(*) AS "NÚMERO DE FUNCIONÁRIOS"
 FROM FUNCIONARIO;
 
  /* CONTAR QUANTOS SUPERMERCADOS TEMOS CADASTROS*/
  
 SELECT COUNT(*) AS "NÚMERO DE SUPERMERCADOS"
 FROM SUPERMERCADO;
 
 /* CONTAR QUANTOS PRODUTOS TEMOS CADASTROS*/
 
 SELECT COUNT(*) AS "NÚMERO DE PRODUTOS"
 FROM PRODUTOS;
 
 
 /* SOMAR O PREÇO TOTAL DE TODOS OS PRODUTOS CADASTRADOS*/
 
 SELECT SUM(PRO_PRECO)
 FROM PRODUTO;
 
 SELECT CONCAT("R$ ", TRUNCATE(SUM(PRO_PRECO),2)) AS "SOMA TOTAL"
 FROM PRODUTO;
 
 
 /*CALCULAR A MÉDIA DE PREÇOS DOS PRODUTOS*/
 
 SELECT AVG(PRO_PRECO)
 FROM PRODUTO;
 
 SELECT CONCAT("R$ ", TRUNCATE(AVG(PRO_PRECO),2)) AS "MÉDIA DOS PREÇOS"
 FROM PRODUTO;
 
 /*SELECIONAR O PRODUTO MAIS CARO*/
 
 SELECT MAX(PRO_PRECO)
 FROM PRODUTO;
 
 /*SELECIONAR O ESTOQUE COM MAIOR QUANTIDADE*/
 
 SELECT MAX(PRO_QUANTIDADE) AS "MAIOR QUANTIDADE"
 FROM PRODUTO;
 
 /*SELECIONAR O PRODUTO MAIS BARATO*/
 
 SELECT MIN(PRO_PRECO) AS "PRODUTO MAIS BARATO"
 FROM PRODUTO;
 
 /*SELECIONAR O ESTOQUE COM MENOR QUANTIDADE*/
 
 SELECT MIN(PRO_QUANTIDADE) AS "EM ESTOQUE COM MENOR QUANTIDADE"
 FROM PRODUTO;
 
 /*SELECIONAR A DATA E HORA ATUAL*/
 
 SELECT NOW() FROM DUAL;
 
 /**/
 
SELECT FUN_NOME AS "NOME DO FUNCIONÁRIO",
		DATE_FORMAT(FUN_DATA_NASCIMENTO, "%d/%m/%Y") AS "DATA DE NASCIMENTO",
        TIMESTAMPDIFF(YEAR,FUN_DATA_NASCIMENTO,NOW()) AS "IDADE"
FROM FUNCIONARIO;

/*FUNÇÕES MATEMÁTICAS
ABS - VALOR ABSOLUTO DE UM NÚMERO
ROUND - ARREDONDAR
POWER - POTENCIAÇÃO
*/

SELECT 	ABS(-10),
		ROUND(PRO_PRECO) AS "PREÇO ARREDONDADO",
        ROUND(POWER(PRO_PRECO,2)) AS "PREÇOS ELEVADOS AO QUADRADO"
FROM PRODUTO;


/*UPPER, LOWER, TRIM*/

SELECT 	UPPER(FUN_NOME) AS "NOME EM LETRAS MAIÚSCULAS",
		LOWER(FUN_NOME) AS "NOME EM LETRAS MINÚSCULAS",
        TRIM("                      LIPE") AS "TIRANDO ESPAÇOS"
FROM FUNCIONARIO;

SELECT 	PRO_QUANTIDADE,
		COUNT(*) AS "REPETIÇÕES"
FROM PRODUTO
GROUP BY PRO_QUANTIDADE;

/*
	COMBINA TABELAS EM UMA SÓ
 */
 
SELECT 	FUN_NOME,
		FUN_CPF
FROM FUNCIONARIO
UNION 
SELECT 	FUN_NOME,
		FUN_CPF
FROM FUNCIONARIO;

SELECT * FROM PRODUTO;

/*
	UNION
*/

SELECT 	PRO_NOME
FROM 	PRODUTO
UNION
SELECT 	"ARROZ 5KG"
FROM	DUAL
UNION 
SELECT "IOGURT DO BOB ESPONJA"
FROM DUAL;

/*
	UNION
*/

SELECT 	PRO_NOME
FROM 	PRODUTO
UNION ALL
SELECT 	"ARROZ 5KG"
FROM	DUAL
UNION ALL
SELECT "IOGURT DO BOB ESPONJA"
FROM DUAL;

/*
	SELECT COM WHERE
    WHERE É O FILTRO
*/

SELECT 	FUN_NOME 			AS "NOME DO FUNCIONÁRIO",
		FUN_CPF 			AS "CPF DO FUNCIONÁRIO",
		FUN_DATA_NASCIMENTO AS "DATA DE NASCIMENTO",
        TIMESTAMPDIFF(YEAR,FUN_DATA_NASCIMENTO,NOW()) AS "IDADE"
FROM FUNCIONARIO
WHERE TIMESTAMPDIFF(YEAR,FUN_DATA_NASCIMENTO,NOW()) >= 25
AND TIMESTAMPDIFF(YEAR,FUN_DATA_NASCIMENTO,NOW()) <= 35;

/*
	RETORNAR OS SUPERMERCADO, FUNCIONÁRIO, CONSUMIDORES , ONDE OS EMAILS = HOTMAIL OU OUTLOOK
*/

SELECT 	CON_NOME 		AS "NOME",
		CON_CPF 		AS "CPF/CNPJ",
        CON_TELEFONE 	AS "TELEFONE",
        CON_EMAIL		AS "EMAIL",
        "CONSUMIDOR" AS "TIPO"
FROM 	CONSUMIDOR
WHERE 	UPPER(CON_EMAIL) LIKE "%HOTMAIL%"
OR UPPER(CON_EMAIL) LIKE "%OUTLOOK%"
UNION
SELECT 	FUN_NOME AS "NOME",
		FUN_CPF AS "CPF/CNPJ",
        FUN_TELEFONE AS "TELEFONE",
        FUN_EMAIL AS "EMAIL",
        "FUNCIONARIO" AS "TIPO"
FROM FUNCIONARIO
WHERE UPPER(FUN_EMAIL) LIKE "%HOTMAIL%"
OR UPPER(FUN_EMAIL) LIKE "%OUTLOOK%"
UNION
SELECT 	SUR_RAZAO_SOCIAL AS "NOME",
		SUP_CNPJ AS "CPF/CNPJ",
        SUP_TELEFONE AS "TELEFONE",
        SUP_EMAIL AS "EMAIL",
        "SUPERMERCADO" AS "TIPO"
FROM SUPERMERCADO
WHERE UPPER(SUP_EMAIL) LIKE "%HOTMAIL%"
OR UPPER(SUP_EMAIL) LIKE "OUTLOOK";

/*
	CROSS JOIN:
    RETORNA TODOS OS PRODUTOS E OS SUPERMERCADOS EM QUE SÃO VENDIDOS
*/

SELECT	PRODUTO.PRO_NOME 				AS "NOME",
		PRODUTO.PRO_CODIGO_BARRAS		AS "CÓDIGO DE BARRAS",
        SUPERMERCADO.SUR_RAZAO_SOCIAL 	AS "RAZÃO SOCIAL"
FROM 	SUPERMERCADO_PRODUTO
CROSS JOIN	SUPERMERCADO
CROSS JOIN PRODUTO
WHERE PRODUTO.PRO_ID = SUPERMERCADO_PRODUTO.FK_PRO_ID
AND SUPERMERCADO.SUP_CNPJ = SUPERMERCADO_PRODUTO.FK_SUP_CNPJ;

/*
	INNER JOIN:
    RETORNA SOMENTE A INTERSECÇÃO -> SOMENTE OS PRODUTOS QUE FORAM COMPRADOS POR ALGUM CONSUMIDOR;
*/

SELECT	PRODUTO_CONSUMIDOR.PCO_ID 	AS "ID DA COMPRA",
		PRODUTO.PRO_NOME 			AS "NOME DO PRODUTO",
        PRODUTO.PRO_CODIGO_BARRAS 	AS "CÓDIGO DE BARRAS",
        CONSUMIDOR.CON_NOME 		AS "NOME DO CONSUMIDOR",
        CONSUMIDOR.CON_CPF 			AS "CPF DO CONSUMIDOR"
FROM PRODUTO_CONSUMIDOR
INNER JOIN PRODUTO ON (PRODUTO_CONSUMIDOR.FK_PRO_ID = PRODUTO.PRO_ID)
INNER JOIN CONSUMIDOR ON (PRODUTO_CONSUMIDOR.FK_CON_CPF = CONSUMIDOR.CON_CPF);

/*
	EXERCICIO: RETORNAREM OS FUNCIONÁRIOS QUE TRABALHAM EM UM  SUPERMERCADO;
    USAR INNER JOIN.
    TABELAS QUE SERÃO UTILIZADAS: FUNCIONARIOS; SUPERMERCADO;
    SUPERMERCADO -> RAZAO SOCIAL
    FUNCIONARIO -> NOME
*/

SELECT 	FUNCIONARIO.FUN_NOME AS "NOME FUNCIONÁRIO",
		SUPERMERCADO.SUR_RAZAO_SOCIAL AS "NOME DO SUPERMERCADO"
FROM SUPERMERCADO
INNER JOIN FUNCIONARIO ON (SUPERMERCADO.SUP_CNPJ = FUNCIONARIO.FK_SUP_CNPJ);

/*
	EXERCÍCIO 2: RETORNAR APENAS OS PRODUTOS QUE EXISTAM EM UM SUPERMERCADO
    RETORNAR O NOME DO PRODUTO E O NOME DO MERCADO QUE ELE ESTÁ DISPONÍVEL
    TABELAS:
		SUPERMERCADO;
        PRODUTO;
        SUPERMERCADO_PRODUTO;
*/

SELECT 	PRODUTO.PRO_NOME AS "NOME DO PRODUTO",
		SUPERMERCADO.SUR_RAZAO_SOCIAL AS "NOME DO MERCADO"
FROM SUPERMERCADO_PRODUTO
INNER JOIN PRODUTO ON (PRODUTO.PRO_ID = SUPERMERCADO_PRODUTO.FK_PRO_ID)
INNER JOIN SUPERMERCADO ON (SUPERMERCADO.SUP_CNPJ = SUPERMERCADO_PRODUTO.FK_SUP_CNPJ);

/*
	LEFT JOIN:
    RETORNA SOMENTE OS DADOS DA TABELA DA DIREITA; SEM SE LIMITAR AOS QUE APARECEM SIMULTANEAMENTE NA INTERSECÇÃO
*/

SELECT * FROM SUPERMERCADO;

INSERT INTO PRODUTO (	PRO_CODIGO_BARRAS,
						PRO_NOME,
                        PRO_PESO,
                        PRO_QUANTIDADE,
                        PRO_PRECO,
                        PRO_DATA_VALIDADE
                                    )

VALUES 				(	"33333333",
						"KITKAT",
                        "30",
                        "1500",
                        "4.50",
                        "2026-01-01"
									);

SELECT 	PRODUTO.PRO_NOME AS "NOME DO PRODUTO",
		SUPERMERCADO.SUR_RAZAO_SOCIAL AS "NOME DO SUPERMERCADO"
FROM PRODUTO
LEFT JOIN SUPERMERCADO_PRODUTO ON (PRODUTO.PRO_ID = SUPERMERCADO_PRODUTO.FK_PRO_ID)
LEFT JOIN SUPERMERCADO ON (SUPERMERCADO.SUP_CNPJ = SUPERMERCADO_PRODUTO.FK_SUP_CNPJ);

/*
	RIGHT JOIN
*/

SELECT 	PRODUTO.PRO_NOME AS "NOME DO PRODUTO",
		SUPERMERCADO.SUR_RAZAO_SOCIAL AS "NOME DO SUPERMERCADO"
FROM PRODUTO
RIGHT JOIN SUPERMERCADO_PRODUTO ON (PRODUTO.PRO_ID = SUPERMERCADO_PRODUTO.FK_PRO_ID)
RIGHT JOIN SUPERMERCADO ON (SUPERMERCADO.SUP_CNPJ = SUPERMERCADO_PRODUTO.FK_SUP_CNPJ);

/*
	SELECT COM LEFT JOIN E RIGHT JOIN
*/

SELECT *
FROM (
		SELECT 		S.SUR_RAZAO_SOCIAL 	AS RAZAO_SOCIAL,
					F.FUN_NOME			AS NOME_FUNCIONARIO,
					P.PRO_NOME 			AS NOME_PRODUTO,
					C.CON_NOME			AS NOME_CONSUMIDOR
		FROM 		SUPERMERCADO S
        LEFT JOIN 	FUNCIONARIO F 				ON (S.SUP_CNPJ = F.FK_SUP_CNPJ)
        LEFT JOIN 	SUPERMERCADO_PRODUTO SP 	ON (S.SUP_CNPJ = SP.FK_SUP_CNPJ)
        LEFT JOIN 	PRODUTO P 					ON (SP.FK_PRO_ID = P.PRO_ID)
        LEFT JOIN 	PRODUTO_CONSUMIDOR PC		ON (P.PRO_ID = PC.FK_PRO_ID)
        LEFT JOIN 	CONSUMIDOR C 				ON (PC.FK_CON_CPF = C.CON_CPF)
        
        UNION
        
		SELECT 		S.SUR_RAZAO_SOCIAL 	AS RAZAO_SOCIAL,
					F.FUN_NOME			AS NOME_FUNCIONARIO,
					P.PRO_NOME 			AS NOME_PRODUTO,
					C.CON_NOME			AS NOME_CONSUMIDOR
		FROM 		SUPERMERCADO S
        RIGHT JOIN 	FUNCIONARIO F 				ON (S.SUP_CNPJ = F.FK_SUP_CNPJ)
        RIGHT JOIN 	SUPERMERCADO_PRODUTO SP 	ON (S.SUP_CNPJ = SP.FK_SUP_CNPJ)
        RIGHT JOIN 	PRODUTO P 					ON (SP.FK_PRO_ID = P.PRO_ID)
        RIGHT JOIN 	PRODUTO_CONSUMIDOR PC		ON (P.PRO_ID = PC.FK_PRO_ID)
        RIGHT JOIN 	CONSUMIDOR C 				ON (PC.FK_CON_CPF = C.CON_CPF)
) SELECT_EXTERNO
ORDER BY 	SELECT_EXTERNO.RAZAO_SOCIAL		ASC,
			SELECT_EXTERNO.NOME_FUNCIONARIO DESC,
            SELECT_EXTERNO.NOME_PRODUTO 	ASC,
            SELECT_EXTERNO.NOME_CONSUMIDOR 	DESC;


SELECT * FROM SUPERMERCADO;
/*1*/
SELECT 	SUPERMERCADO.SUR_RAZAO_SOCIAL AS "NOME MERCADO",
		PRODUTO.PRO_NOME AS "NOME DO PRODUTO"
FROM 	SUPERMERCADO_PRODUTO 
INNER JOIN SUPERMERCADO ON (SUPERMERCADO.SUP_CNPJ = SUPERMERCADO_PRODUTO.FK_SUP_CNPJ)
INNER JOIN PRODUTO ON (PRODUTO.PRO_ID = SUPERMERCADO_PRODUTO.FK_PRO_ID);
/*2*/
SELECT 	FUNCIONARIO.FUN_NOME AS "NOME DO FUNCIONÁRIO",
		SUPERMERCADO.SUR_RAZAO_SOCIAL AS "NOME DO SUPERMERCADO"
FROM SUPERMERCADO
INNER JOIN FUNCIONARIO ON (FUNCIONARIO.FK_SUP_CNPJ = SUPERMERCADO.SUP_CNPJ);

/*3*/
SELECT 	CONSUMIDOR.CON_NOME AS "NOME DO CONSUMIDOR",
		PRODUTO.PRO_NOME AS "NOME DO PRODUTO"
FROM PRODUTO_CONSUMIDOR
INNER JOIN CONSUMIDOR ON (CONSUMIDOR.CON_CPF = PRODUTO_CONSUMIDOR.FK_CON_CPF)
INNER JOIN PRODUTO ON (PRODUTO.PRO_ID = PRODUTO_CONSUMIDOR.FK_PRO_ID);

/*4*/
SELECT 	PRODUTO.PRO_NOME AS "NOME DO PRODUTO",
		CONSUMIDOR.CON_NOME AS "CONSUMIDOR"
FROM PRODUTO_CONSUMIDOR
INNER JOIN CONSUMIDOR ON (CONSUMIDOR.CON_CPF = PRODUTO_CONSUMIDOR.FK_CON_CPF)
INNER JOIN PRODUTO ON (PRODUTO.PRO_ID = PRODUTO_CONSUMIDOR.FK_PRO_ID);

/*5*/
SELECT 	SUPERMERCADO.SUR_RAZAO_SOCIAL 	AS "NOME DO SUPERMERCADO",
		COUNT(PRODUTO.PRO_ID) 		AS "NÚMERO DE PRODUTOS"
FROM SUPERMERCADO_PRODUTO
INNER JOIN SUPERMERCADO ON (SUPERMERCADO.SUP_CNPJ = SUPERMERCADO_PRODUTO.FK_SUP_CNPJ)
INNER JOIN PRODUTO ON (PRODUTO.PRO_ID = SUPERMERCADO_PRODUTO.FK_PRO_ID)
GROUP BY SUPERMERCADO.SUR_RAZAO_SOCIAL;

/*EXERCICIOS LEFT JOIN: 1*/
select 	SUPERMERCADO.SUR_RAZAO_SOCIAL as "nome do supermercado",
		PRODUTO.PRO_NOME AS "NOME DO PRODUTO"
FROM SUPERMERCADO
LEFT JOIN SUPERMERCADO_PRODUTO ON (SUPERMERCADO.SUP_CNPJ = SUPERMERCADO_PRODUTO.FK_SUP_CNPJ)
LEFT JOIN PRODUTO ON (SUPERMERCADO_PRODUTO.FK_PRO_ID = PRODUTO.PRO_ID);

/*LEFT JOIN 2*/

SELECT 	FUNCIONARIO.FUN_NOME AS "NOME DO FUNCIONARIO",
		SUPERMERCADO.SUR_RAZAO_SOCIAL AS "NOME DO SUPERMERCADO"
FROM FUNCIONARIO
LEFT JOIN SUPERMERCADO ON (SUPERMERCADO.SUP_CNPJ = FUNCIONARIO.FK_SUP_CNPJ);

/*LEFT JOIN 3*/

SELECT 	CONSUMIDOR.CON_NOME AS "NOME DO CONSUMIDOR",
		PRODUTO.PRO_NOME AS "NOME DO PRODUTO"
FROM CONSUMIDOR
LEFT JOIN PRODUTO_CONSUMIDOR ON (CONSUMIDOR.CON_CPF = PRODUTO_CONSUMIDOR.FK_CON_CPF)
LEFT JOIN PRODUTO ON (PRODUTO.PRO_ID = PRODUTO_CONSUMIDOR.FK_PRO_ID);

/*LEFT JOIN 4*/

SELECT 	PRODUTO.PRO_NOME AS "NOME DO PRODUTO",
		CONSUMIDOR.CON_NOME AS "NOME DO CONSUMIDOR"
FROM PRODUTO
LEFT JOIN PRODUTO_CONSUMIDOR ON (PRODUTO.PRO_ID = PRODUTO_CONSUMIDOR.FK_PRO_ID)
LEFT JOIN CONSUMIDOR ON (CONSUMIDOR.CON_CPF = PRODUTO_CONSUMIDOR.FK_CON_CPF);

/*LEFT JOIN 5*/

SELECT 	SUPERMERCADO.SUR_RAZAO_SOCIAL AS "NOME DO SUPERMERCADO",
		FUNCIONARIO.FUN_NOME AS "NOME DO FUNCIONARIO"
FROM SUPERMERCADO
LEFT JOIN FUNCIONARIO ON (SUPERMERCADO.SUP_CNPJ = FUNCIONARIO.FK_SUP_CNPJ);

/*
	RIGHT JOINS
*/

/*EX 1*/

SELECT 	P.PRO_NOME 			AS "NOME DO PRODUTO",
		S.SUR_RAZAO_SOCIAL 	AS "NOME DO MERCADO"
FROM SUPERMERCADO S
RIGHT JOIN SUPERMERCADO_PRODUTO SP ON (SP.FK_SUP_CNPJ = S.SUP_CNPJ)
RIGHT JOIN PRODUTO P ON (SP.FK_PRO_ID = P.PRO_ID);

/*EX 2*/

SELECT 	CON_NOME AS "NOME DO CONSUMIDOR",
		PRO_NOME AS "NOME DO PRODUTO"
FROM CONSUMIDOR
RIGHT JOIN PRODUTO_CONSUMIDOR PC ON (PC.FK_CON_CPF = CONSUMIDOR.CON_CPF)
RIGHT JOIN PRODUTO P ON (P.PRO_ID = PC.FK_PRO_ID);

/*EX 3*/

SELECT 	FUN_NOME AS "NOME DO FUNCIONARIO",
		SUR_RAZAO_SOCIAL AS "NOME DO SUPERMERCADO"
FROM FUNCIONARIO
RIGHT JOIN SUPERMERCADO S ON (S.SUP_CNPJ = FUNCIONARIO.FK_SUP_CNPJ);

/*EX 4*/

SELECT 	SUR_RAZAO_SOCIAL AS "NOME DO SUPERMERCADO",
		PRO_NOME AS "NOME DO PRODUTO"
FROM SUPERMERCADO
RIGHT JOIN SUPERMERCADO_PRODUTO SP ON (SP.FK_SUP_CNPJ = SUP_CNPJ)
RIGHT JOIN PRODUTO P ON (SP.FK_PRO_ID = P.PRO_ID);

/*EX 5*/

SELECT 	CON_NOME AS "NOME DO COSUMIDOR",
		PRO_NOME AS "PRO NOME"
FROM CONSUMIDOR
RIGHT JOIN PRODUTO_CONSUMIDOR PC ON (CONSUMIDOR.CON_CPF = PC.FK_CON_CPF)
RIGHT JOIN PRODUTO P ON (P.PRO_ID = PC.FK_PRO_ID);

/*SELECIONAR APENAS OS PRODUTOS QUE POSSUEM REGISTRO EM UM SUPERMERCADO E QUE FORAM COMPRADOS POR UM CONSUMIDOR*/

SELECT 	P.PRO_NOME AS "NOME DO PRODUTO",
		P.PRO_CODIGO_BARRAS AS "CÓDIGO DE BARRAS",
		P.PRO_PRECO AS "PREÇO DO PRODUTO"
FROM PRODUTO P
WHERE 	P.PRO_ID IN ( SELECT SP.FK_PRO_ID FROM SUPERMERCADO_PRODUTO SP)
AND 	P.PRO_ID IN (SELECT PC.FK_PRO_ID FROM PRODUTO_CONSUMIDOR PC);


USE BD_supermercado_funcionario_produto_consumidor;

/*
	SELECIONAR APENAS OS PRODUTOS QUE NÃO POSSUEM REGISTRO EM UM SUPERMERCADO E QUE NÃO FORAM COMPRADOS POR UM CONSUMIDOR
*/

SELECT 	P.PRO_NOME AS "NOME DO PRODUTO",
		P.PRO_CODIGO_BARRAS AS "CÓDIGO DE BARRAS",
		P.PRO_PRECO AS "PREÇO DO PRODUTO"
FROM PRODUTO P
WHERE 	P.PRO_ID NOT IN ( SELECT SP.FK_PRO_ID FROM SUPERMERCADO_PRODUTO SP)
AND 	P.PRO_ID NOT IN (SELECT PC.FK_PRO_ID FROM PRODUTO_CONSUMIDOR PC);

/*
	Selecionar os SUPERMERCADOS que tem o preço de todos os produtos menor que R$ 10,00
*/

SELECT S.SUR_RAZAO_SOCIAL
FROM SUPERMERCADO S
WHERE 10 < ALL (
	SELECT 	P.PRO_PRECO
    FROM	PRODUTO P
);

/*
	Listar todos os produtos cujos preços sejam maiores que o preço de qualquer PRODUTO vendido no SUPERMERCADO
    com cnpj: 1234567045101
*/

SELECT 	P.PRO_NOME AS "PRODUTOS",
		P.PRO_PRECO AS "PREÇO"
FROM PRODUTO P
WHERE P.PRO_PRECO > ANY (
	SELECT 		P.PRO_PRECO
    FROM		PRODUTO P
    INNER JOIN 	SUPERMERCADO_PRODUTO SP
    ON 			(P.PRO_ID = SP.FK_PRO_ID)
    WHERE		SP.FK_SUP_CNPJ = '1234567045101'
);


/*
	Listar todos os consumidores que compraram pelo menos UM produto
*/

SELECT	C.CON_NOME,
		C.CON_CPF
FROM 	CONSUMIDOR C
WHERE	EXISTS (
	SELECT 1
    FROM PRODUTO_CONSUMIDOR PC
    WHERE PC.FK_CON_CPF = C.CON_CPF
);

/*
	liste todos os consumidores que não compraram nenhum produto
*/

SELECT	C.CON_NOME,
		C.CON_CPF
FROM 	CONSUMIDOR C
WHERE	NOT EXISTS (
	SELECT 1
    FROM PRODUTO_CONSUMIDOR PC
    WHERE PC.FK_CON_CPF = C.CON_CPF
);

/*
	TCL => LINGUAGEM DE CONTROLE DE TRANSAÇÕES:
    COMMIT
*/

-- PASSO 1: INICIAR A TRANSAÇÃO

START TRANSACTION;

-- PASSO 2: ESCREVER O COMANDO DML

INSERT INTO SUPERMERCADO 	(SUP_CNPJ,
							SUR_RAZAO_SOCIAL,
                            SUP_TELEFONE,
                            SUP_EMAIL,
                            SUP_ENDERECO_LOGRADOURO,
                            SUP_ENDERECO_NUMERO,
                            SUP_ENDERECO_CIDADE,
                            SUP_EDERECO_ESTADO
)
VALUES						("11111111000111",
							"SUPERMERCADO PONTES",
                            "11987654321",
                            "pontes@pontes.com",
                            "Rua do Pontes",
                            "100",
                            "tambaú",
                            "SP"
);

-- PASSO 3: SE TUDO DEU CENTRO, ENVIA PRO BANCO
COMMIT;

/*ROLLBACK*/

-- PASSO 1: INICIAR A TRANSAÇÃO

START TRANSACTION;

-- PASSO 2: ESCREVER O COMANDO DML

INSERT INTO SUPERMERCADO 	(SUP_CNPJ,
							SUR_RAZAO_SOCIAL,
                            SUP_TELEFONE,
                            SUP_EMAIL,
                            SUP_ENDERECO_LOGRADOURO,
                            SUP_ENDERECO_NUMERO,
                            SUP_ENDERECO_CIDADE,
                            SUP_EDERECO_ESTADO
)
VALUES						("11111111000111",
							"SUPERMERCADO PONTES",
                            "11987654321",
                            "pontes@pontes.com",
                            "Rua do Pontes",
                            "100",
                            "tambaú",
                            "SP"
);

-- PASSO 3: SE DER ERRO, NÃO ENVIA PRO BANCO
ROLLBACK;

/*Save point*/

START TRANSACTION;

INSERT INTO SUPERMERCADO (SUP_CNPJ, SUR_RAZAO_SOCIAL, SUP_TELEFONE, SUP_EMAIL,
SUP_ENDERECO_LOGRADOURO, SUP_ENDERECO_NUMERO, SUP_ENDERECO_CIDADE, SUP_EDERECO_ESTADO)
VALUES ("33333333000133", "Supermercado Nova Era", "11987654321", "contato@novaera.com.br",
"Rua Nova", "150", "Porto Alegre", "RS");

-- Criar um ponto de salvamento (save point)

SAVEPOINT SAVEPOINT_PRODUTO1;

-- INSERIR O 1° PRODUTO

INSERT INTO PRODUTO (PRO_CODIGO_BARRAS, PRO_NOME, PRO_PESO, PRO_QUANTIDADE, PRO_PRECO, PRO_DATA_VALIDADE)
VALUES ("1234567890987", "AÇÚCAR 1KG", 200, 3.00, '2025-06-30');

SAVEPOINT SAVEPOINT_PRODUTO2;

-- INSERIR PRODUTO COM DADO INVÁLIDO (SIMULANDO O ERRO)

INSERT INTO PRODUTO (PRO_CODIGO_BARRAS, PRO_NOME, PRO_PESO, PRO_QUANTIDADE, PRO_PRECO, PRO_DATA_VALIDADE)
VALUES ("9876543210123", "Café 500g", "500g", -100, 15.00, '2025-09-39'); -- quantidade negativa (erro)

-- se ocorrer um erro, reverter apenas até o segundo savepoint

ROLLBACK TO SAVEPOINT_PRODUTO2;

-- Confirmar as mudanças até o primeiro savepoint

COMMIT;